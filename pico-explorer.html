<!-- <script type="text/javascript" src="bower_components/diya-sdk-ng/dist/diya-sdk.js"></script> -->
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-icons/core-icons.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/core-selector/core-selector.html">

<link rel="import" href="bower_components/diya-chooser/diya-chooser-dialog.html">

<polymer-element name="pico-explorer" attributes="selector">
	<template>
		<style>
			:host{
				display: flex;
				flex-direction: column;
				align-items: center;
				flex-wrap: wrap;
				}

			#listfiles paper-button{
				display: flex;
				height: 30px;
				width:  250px;
				float: right;
				border-radius: 5px;
			}


			#listfiles paper-button::shadow #ripple{
				color: #3680F9;
				}


			#listfiles{
				/*border-color: #3680F9;*/
				display: flex;
				width:  100%;
				flex-direction: column;
				justify-content: space-between;
				align-items: space-between;
				}

			#listfiles core-icon paper-ripple paper-item{
				color: #3680F9;
				display: flex;
			    flex-direction: column;
				justify-content: space-between;
				align-item: space-between;
				width:100%;
				height:100%;
				}

				paper-item{
					display: block;
					/*position: relative;*/
					/*height: 7%;
					width: 7%;*/
				}
/*
				#files{
					border: 1px solide;
					backgroung: white ;
				}*/
				paper-ripple{
					height: 10%;
					width:10%;
				}

		</style>

		<diya-chooser-dialog selector="{{selector}}"></diya-chooser-dialog>

		<div id="listfiles">
			<core-selector>
				<section id="files">
					<template repeat="{{f, i in files}}">   <!--lorsqu il rencontre un elt dans rep-->
						<paper-item raised on-tap="{{actionOpenFile}}"  file-id="{{i}}" relative layout horizontal center><span style="color: #3680F9"></span>{{f.path}}</paper-item>
					</template>
				</section>
			</core-selector>
		</div>
</template>
<script>

		Polymer({
			ready: function(){

				var that = this;
				this.explorer = null;
				this.status = '...';
				this.files = [];
				// this.directory = false;

				//connexion

			},


			selectorChanged: function(){
				if (this.selector){


				}


				var that = this;
				var path ='.';
				that.actionListFiles(path);
				//d1(/.*/).listFiles();


			},


			actionListFiles: function(file){	//<<path sera name
				var that = this;
				if (this.explorer === 0){
						//console.log("error connexion");
				}
				else{
					d1(that.selector).listFiles(file, function(peerId, err, filerec){	//<<file sera name
						while(that.files.length) that.files.pop(); //tant qu'il y a des elts dans le tableau

							/*
							files.forEach(function(f){
								that.files.push(f);
							});
							***********************/
						for (var i=0; i< filerec.files.length; i++){	//files = Object
							console.log(filerec.files[i].path);
							that.files.push(filerec.files[i]);
						};
						var files = that.files;
						that.status = 'got it';
						console.log(files);

					});
				}
			},


			actionOpenFile: function(evt){

				var that = this;
				if (that.explorer === 0){
					throw(err);
				}

				var index = parseInt(evt.target.attributes['file-id'].value);

				var file = this.files[index].path;
				var type = this.files[index].type;

				console.log(file);
				console.log(type);


				if (type === 'file'){
					// var fichier = this.files[index].path;
					// var type = this.files[index].type;
					// directory = false;
					d1(that.selector).openFile(file, type,  function(peerId, err, data){
						console.log("open");
					});
				}




				else if (type === 'directory'){	//si doc
					// directory = true;

					// d1(that.selector).openFile(file, type, function(peerId, err, data){
					// 	d1(that.selector).listFiles(file, function(peerId, err, filerec){	//listing dans le doc choisi
					//
					// 		console.log('filerec: ');
					// 		console.log(filerec);
					//
					// 		for (var i=0; i< filerec.files.length; i++){
					// 			console.log(filerec.files[i].path);
					// 			that.files.push(filerec.files[i]);
					// 		};
					// 		var files = that.files;
					// 		that.status = 'got it';
					// 			console.log(files);
					// 	});
					// })
				}

				// else if(this.files[index].type === 'directory'){
				// 	var directory = this.files[index].path;
				// 	var that = this;
				// 	d1(/.*/).listFiles(function(peerId, err, filerec){
				// 		while(that.directory.length) that.directory.pop(); //tant qu'il y a des elts dans le tableau
				//
				//
				//
				// 		for (var i=0; i< filerec.directory.length; i++){
				// 			console.log(filerec.directory[i].path);
				// 			that.files.push(filerec.directory[i]);
				// 		};
				// 		var files = that.directory;
				// 		that.status = 'got it';
				// 		that.files = that.files;console.log(that.files);
				//
				// 	});
				//
				// }

			},


			// OrderOpen : function(){
			// 	d1(that.selector).OrderOpen(request, function(peerId, err, data){
			// 		console.log(data);
			// 	});
			// },
			//
			// ListViewers: function(){
			// 	d1(that.selector).ListViewers(subscription, function(peerId, err, data){
			// 		console.log(subscription);
			// 	})
			// }




		});
	</script>
</polymer-element>
