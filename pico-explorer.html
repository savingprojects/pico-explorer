<!-- <script type="text/javascript" src="bower_components/diya-sdk-ng/dist/diya-sdk.js"></script> -->
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-icons/core-icons.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../core-selector/core-selector.html">

<polymer-element name="pico-explorer" attributes="selector">
	<template>
		<style>
			:host{
				display: flex;
				flex-direction: column;
				align-items: center;
				flex-wrap: wrap;
				}

			#listfiles paper-button{
				display: flex;
				height: 30px;
				width:  250px;
				float: right;
				border-radius: 5px;
			}


			#listfiles paper-button::shadow #ripple{
				color: #3680F9;
				}


			#listfiles{
				/*border-color: #3680F9;*/
				display: flex;
				width:  100%;
				flex-direction: column;
				justify-content: space-between;
				align-items: space-between;
				}

			#listfiles core-icon paper-ripple paper-item{
				color: #3680F9;
				display: flex;
			    flex-direction: column;
				justify-content: space-between;
				align-item: space-between;
				width:100%;
				height:100%;
				}

				paper-item{
					display: block;
					/*position: relative;*/
					/*height: 7%;
					width: 7%;*/
				}
/*
				#files{
					border: 1px solide;
					backgroung: white ;
				}*/
				paper-ripple{
					height: 10%;
					width:10%;
				}

				.even{
					background: #BBD2E1;
				}

		</style>


		<div id="listfiles">
			<core-selector>
				<section id="files">
					<template repeat="{{f, i in files}}">   <!--lorsqu il rencontre un elt dans rep-->
						<!-- <template if={{vd}}> -->
							<paper-item class="{{i%2===0? 'even':'odd'}}"raised on-tap="{{actionOpenFile}}"  file-id="{{i}}"><core-icon style="color: #3680F9" icon="{{f.icon}}"></core-icon> {{f.path}}</paper-item>
						<!-- </template> -->
					</template>
				</section>
			</core-selector>
		</div>
</template>
<script>

		Polymer({
			ready: function(){

				this.icon;
				var that = this;
				this.explorer = null;
				this.status = '...';
				this.files = [];
				this.vd = false;
				this.img = false;
				// this.directory = false;

				//connexion
			},

			selectorChanged: function(){
				if (this.selector){


				}

				var that = this;
				var path ='.';
				that.actionListFiles(path);
			},


			actionListFiles: function(file){
				var that = this;
				if (this.explorer === 0){

				}
				else{
					d1(that.selector).listFiles(file, function(peerId, err, filerec){
						while(that.files.length) that.files.pop(); //tant qu'il y a des elts dans le tableau

							/*
							files.forEach(function(f){
								that.files.push(f);
							});
							***********************/
						for (var i=0; i< filerec.files.length; i++){	//files = Object
							console.log(filerec.files[i].path);
							that.files.push(filerec.files[i]);
						};
						var files = that.files;

						////////
						for(var i=0; i< filerec.files.length; i++){
							var extension = that.files[i].path.split(".").pop();
							extension = extension.toLowerCase();

							switch (extension){
								case "img":
								case "jpg":
								case "png":
								case "jpeg":
										filerec.files[i].icon = "perm-media";
										break;
								case "mp4":
								case "avi":
								case "mov":
										filerec.files[i].icon = "group-work";
								    	break;
								default: files[i].icon = "file-download"; break;
							}
						};
						var files = that.files;
						////////

						console.log(files);

					});
				}
			},

			actionOpenFile: function(evt){

				var that = this;
				if (that.explorer === 0){
					throw(err);
				}

				var index = parseInt(evt.target.attributes['file-id'].value);

				var file = this.files[index].path;
				var type = this.files[index].type;

				console.log(file);
				console.log(type);


				if (type === 'file'){
					// var fichier = this.files[index].path;
					// var type = this.files[index].type;
					// directory = false;
					d1(that.selector).openFile(file, type,  function(peerId, err, data){
						console.log("open");
					});
				}

				else if (type === 'directory'){	//si doc
					// directory = true;

					// d1(that.selector).openFile(file, type, function(peerId, err, data){
					// 	d1(that.selector).listFiles(file, function(peerId, err, filerec){	//listing dans le doc choisi
					//
					// 		console.log('filerec: ');
					// 		console.log(filerec);
					//
					// 		for (var i=0; i< filerec.files.length; i++){
					// 			console.log(filerec.files[i].path);
					// 			that.files.push(filerec.files[i]);
					// 		};
					// 		var files = that.files;
					// 		that.status = 'got it';
					// 			console.log(files);
					// 	});
					// })
				};
			},


		});
	</script>
</polymer-element>
